<app-horizontal-image-list 
  [items]="categories"
  (selectedItemChange)="selectCategory($event)"
></app-horizontal-image-list>

<ion-fab slot="fixed" vertical="bottom" horizontal="end" *ngIf="orderItems.length > 0">
  <ion-fab-button (click)="createOrder()">
    <ion-icon name="send"></ion-icon>
  </ion-fab-button>
</ion-fab>

<ion-fab slot="fixed" vertical="bottom" horizontal="start" *ngIf="orderItems.length > 0">
  <ion-fab-button size="small" color="light" (click)="setArticlesModalOpen($event, true)">
    <ion-icon name="information-circle-outline"></ion-icon>
  </ion-fab-button>
</ion-fab>

<div 
  *ngIf="products.length > 0"
  class="product-wrap"
>
  <ion-card 
    (click)="selectProduct(product)" 
    [ngClass]="{
      'product-card-selected': isSelected(product)
    }"
    class="product"
    *ngFor="let product of products"
  >
    <div>
      <div class="product-quantity product-batch" *ngIf="isSelected(product)">
        {{ getQuantity(product) }}
      </div>
      @if (product.complements?.length || 0 > 0){
        <div class="product-less product-batch" *ngIf="isSelected(product)" (click)="setArticlesModalOpen($event, true)">
          <ion-icon name="information-outline"></ion-icon>
        </div>
      } @else {
        <div class="product-less product-batch" *ngIf="isSelected(product)" (click)="deselectProduct($event, product)">
          -
        </div>
      }
      
      <div
        [ngStyle]="{
            'background-image': 'url(' + product.image_data?.image + ')',
          }"
        class="product-image">
      </div>
        <ion-text class="product-name">
            {{ product.name }}
        </ion-text>
    </div>
  </ion-card>
</div>

<div *ngIf="products.length == 0" class="empty-list-text">
  No hay nada aún.
</div>

<ion-modal (didDismiss)="setComplementsModalOpen(false)" [isOpen]="isComplementsModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Artículos</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="setComplementsModalOpen(false)">Hecho</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <div 
        class="product-wrap"
      >
        <ion-card
          (click)="addComplement(complement)"
          class="product"
          *ngFor="let complement of complements"
        >
          <div>
            <div
              [ngStyle]="{
                  'background-image': 'url(' + complement.image_data?.image + ')',
                }"
              class="product-image">
            </div>
              <ion-text class="product-name">
                  {{ complement.name }}
              </ion-text>
          </div>
        </ion-card>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal (didDismiss)="setArticlesModalOpen($event, false)" [isOpen]="isArticlesModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Artículos</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="setArticlesModalOpen($event, false)">Hecho</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-list>
        <ion-item *ngFor="let item of groupedItems" lines="none">
          <div class="item-wrap">
            <ion-label class="ion-text-wrap " slot="start">
              {{ item.product_data?.name }} x{{ getQuantity(item.product_data) }}
            </ion-label>
            <div class="complement-wrapper">
              @for (complement of item.complements_data; track complement) {
                <label class="complement-item">
                  {{ complement.name }}
                </label>
              }
              <ion-buttons slot="end" class="quantity-buttons">
              <ion-button
                size="small"
                color="primary"
                (click)="decreaseProduct(item)"
              >
              <ion-text *ngIf="item.quantity! > 1">
                <ion-icon name="remove-outline"></ion-icon>
              </ion-text>
              <ion-text *ngIf="item.quantity! == 1">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-text>
              </ion-button>

              <ion-input
                class="quantity-input"
                type="number"
                [(ngModel)]="item.quantity"
                readonly
              ></ion-input>

              <ion-button
                size= "small"
                color="primary"
                (click)="increaseProduct(item)"
              >
                <ion-icon name="add-outline"></ion-icon>
              </ion-button>
              <ion-button
                size= "small"
                color="primary"
                (click)="presentAlert(item)"
              >
                <ion-icon name="document-outline"></ion-icon>
              </ion-button>
            </ion-buttons>
            </div>
          </div>
          
        </ion-item>
      </ion-list>

    </ion-content>
  </ng-template>
</ion-modal>

